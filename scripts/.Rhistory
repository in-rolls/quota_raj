library(tidyr)
library(expss)# library(interplot)
final_panel <- read_dta("final_panel.dta")
first_reservation_year <- final_panel %>%
# Convert variable to factor, so we can use complete later. We do this within
# group_by, because we want to operate by level of variable
group_by(state_name=factor(state_name)) %>%
# Remove all rows of variable if there aren't any rows with values==0
filter(any(reservation==0)) %>%
# Remove all rows with values != 0
filter(reservation != 0) %>%
# Keep the first row of each variable, after sorting by Date
# This gives us the first non-zero row
arrange(year_1) %>%
slice(1) %>%
# Use complete to bring back a row for any level of variable that
# didn't start with any rows with values==0
ungroup() %>%
complete(state_name)
proportion_plot <- ggplot(data=final_panel, aes(x=year_1, y=sex_prop, group = state_name)) +
geom_line() +
geom_point( size=1, shape=20, fill="white") +
geom_vline(data = first_reservation_year, aes(xintercept=year_1-1), color="red",
linetype="dashed",size=0.4) +
scale_linetype_discrete(name = "Year of Reservation") +
facet_wrap( "state_name",scales='free_x')+xlab("Election Year") +
ylab("Proportion of Women in state Assembly")+ theme_bw()+
theme(panel.border = element_blank(), panel.grid.major = element_blank(),
strip.background = element_blank(),panel.grid.minor = element_blank(),axis.title=element_text(size=16,face="bold"))
rm(list=ls())
setwd("/Users/varun/Dropbox/PhD/2YP/Data/data_analysis")
library(haven)
library(stargazer)
library(readstata13)
library(readr)
library(plyr)
library(dplyr)
library(ggplot2)
library(gghighlight)
library(plm)
library(lmtest)
library(multiwayvcov)
library(expss)
library(broom)
library(tidyr)
library(expss)# library(interplot)
final_panel <- read_dta("final_panel.dta")
test <- final_panel %>% select(reservation, state_name, year_1)
test <- test %>% group_by(state_name) %>%
mutate(first.treat = case_when(reservation == 1 ~ year_1)) %>%
test <- test %>% mutate(testing = first(na.omit(first.treat)))
# Load libs
library(readr)
library(dplyr)
library(xtable)
library(fuzzyjoin)
library(stringr)
library(here)
library(kableExtra)
library(fixest)
# Load data
data_dir <- here("..", "data/sarpanch_election_data")
sp_fin_file <- here(data_dir, "sp_2005_2010_2015_2020_fin.csv")
raj_panch <- readr::read_csv(sp_fin_file)
# Create reservation dummies, caste group dummies -------------------------
# inefficient but does the job
raj_panch <- raj_panch %>%
mutate(
treat_2005 = ifelse(raj_panch$reservation_2005 %in% c("GEN W", "OBC W", "SC W", "ST W"), 1, 0),
treat_2010 = ifelse(raj_panch$reservation_2010 %in% c("GENW", "OBCW", "SCW", "STW"), 1, 0),
treat_2015 = ifelse(raj_panch$reservation_2015 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
treat_2020 = ifelse(raj_panch$reservation_2020 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
obc_2005 = ifelse(raj_panch$reservation_2005 %in% c("OBC W"), 1, 0),
obc_2010 = ifelse(raj_panch$reservation_2010 %in% c("OBCW"), 1, 0),
obc_2015 = ifelse(raj_panch$reservation_2015 %in% c("OBC (Woman)"), 1, 0),
obc_2020 = ifelse(raj_panch$reservation_2020 %in% c("OBC (Woman)"), 1, 0),
dalit_2005 = ifelse(raj_panch$reservation_2005 %in% c("SC W", "ST W"), 1, 0),
dalit_2010 = ifelse(raj_panch$reservation_2010 %in% c("SCW", "STW"), 1, 0),
dalit_2015 = ifelse(raj_panch$reservation_2015 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
dalit_2020 = ifelse(raj_panch$reservation_2020 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
always_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 3, 1, 0),
never_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 0, 1, 0),
sometimes_treated = ifelse(treat_2005 + treat_2010 + treat_2015 > 0, 1, 0),
treatment_intensity = treat_2005 + treat_2010 + treat_2015
)
m_05_10 <- feols((sex_2010 =="F") ~ treat_2005, vcov = ~gp_2010, data = raj_panch)
summary(m_05_10)
m_05_10_dfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010, vcov = ~gp_2010,  data = raj_panch)
summary(m_05_10_dfe)
m_05_10_psfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010 + samiti_name_2010,vcov = ~gp_2010, data = raj_panch)
summary(m_05_10_psfe)
m_05_10_gpfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010 + samiti_name_2010 + gp_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2010, data = raj_panch)
summary(m_05_10_gpfe)
fixedEffects = feols(m_05_10_gpfe)
summary(fixedEffects)
plot(fixedEffects)
# TeX
models_05_10_list <- list(m_05_10, m_05_10_dfe, m_05_10_psfe, m_05_10_gpfe)
etable(models_05_10_list, tex=T, file = here("..", "tables", "models_05_10.tex"))
extract_names_2015 <- raj_panch %>% select(name_2015)
library(stringr)
extract_names_2015 <- extract_names_2015 %>%
mutate(first_name = str_extract(name_2015, "\\w+")) %>%
mutate(first_name = ifelse(nchar(first_name) == 1, "", first_name))
extract_names_2015 <- extract_names_2015[,2, drop = FALSE]
extract_names_2015 <- extract_names_2015 <- extract_names_2015 %>%
mutate_all(tolower)
#naampy takes a vector of names, and doesn't handle blanks hence replace blanks with "asdfghjkl"
extract_names_2015 <- extract_names_2015 %>%
mutate(first_name = ifelse(first_name == "", "asdfghjkl", first_name))
dir <- here("..", "data/naampy_pred_names_2015")
pred_name_file <- here(dir, "pred_names_2015.csv")
pred_names <- read_csv(pred_name_file)
# to check if the lengths are the same
# length(pred_names$name) == length(extract_names_2015$first_name)
names(pred_names)
pred_names <-  pred_names %>%
rename(first_name_15 = name) %>%
rename(pred_gender_15 = pred_gender) %>%
rename(pred_prob_15 = pred_prob)
names(pred_names)
pred_names <- pred_names %>%
mutate(across(everything(), ~ ifelse(first_name_15 == "asdfghjkl",NA, .)))
naampy_merge_raj_panch <- cbind(raj_panch, pred_names)
# to check if cbind resulted in a proper match.
# extract first name from original data, ie., from how it was in raj_panch
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(first_name_15_og = str_extract(name_2015, "\\w+")) %>%
mutate(first_name_15_og = ifelse(nchar(first_name_15_og) == 1, "", first_name_15_og))
# check if first names in raj_panch  and naampy merge are the same
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(first_name_15_og = ifelse(first_name_15_og == "", NA, first_name_15_og))
naampy_merge_raj_panch$first_name_15_og <- tolower(naampy_merge_raj_panch$first_name_15_og)
print(identical(naampy_merge_raj_panch$first_name_15_og[2:length(naampy_merge_raj_panch$first_name_15_og)],
naampy_merge_raj_panch$first_name_15[2:length(naampy_merge_raj_panch$first_name_15)]))
unique(naampy_merge_raj_panch$pred_gender_15)
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(sex_2015 = ifelse(naampy_merge_raj_panch$pred_gender_15 == "female", "F",
ifelse(pred_gender_15 == "male", "M", "NA")))
summary(naampy_merge_raj_panch$pred_prob_15) # pred_prob \in [0.5006, 0.9998]
data_threshold_50 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.5006)
m_50_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15)
m_50_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_dfe)
m_50_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_psfe)
m_50_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_gpfe)
models_50_list <- list(m_50_10_15, m_50_10_15_dfe, m_50_10_15_psfe, m_50_10_15_gpfe)
etable(models_50_list, tex = TRUE, file = here("..", "tables", "models_50_10_15.tex"),   placement = "htbp", title = "Results for Threshold 0.52")
data_threshold_60 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.6)
m_60_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15)
m_60_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_dfe)
m_60_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_psfe)
m_60_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_gpfe)
# TeX
models_60_list <- list(m_60_10_15, m_60_10_15_dfe, m_60_10_15_psfe, m_60_10_15_gpfe)
etable(models_60_list, tex = TRUE, file = here("..", "tables", "models_60_10_15.tex"),   placement = "htbp", title = "Results for Threshold 0.6")
data_threshold_70 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.7)
m_70_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15)
m_70_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_dfe)
m_70_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_psfe)
m_70_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_gpfe)
# TeX
models_70_list <- list(m_70_10_15, m_70_10_15_dfe, m_70_10_15_psfe, m_70_10_15_gpfe)
etable(models_70_list, tex = TRUE, file = here("..", "tables", "models_70_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.7")
# Naampy Pred_Prob > 0.8
data_threshold_80 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.8)
m_80_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15)
m_80_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_dfe)
m_80_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_psfe)
m_80_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_gpfe)
# TeX
models_80_list <- list(m_80_10_15, m_80_10_15_dfe, m_80_10_15_psfe, m_80_10_15_gpfe)
etable(models_80_list, tex = TRUE, file = here("..", "tables", "models_80_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.8")
# Naampy Pred_prob > 0.90
data_threshold_90 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.9)
m_90_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15)
m_90_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_dfe)
m_90_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_psfe)
m_90_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_gpfe) #weird. co-eff >1!
models_90_list <- list(m_90_10_15, m_90_10_15_dfe, m_90_10_15_psfe, m_90_10_15_gpfe)
etable(models_90_list, tex = TRUE, file = here("..", "tables", "models_90_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.9")
# TeX
models_90_list <- list(m_90_10_15, m_90_10_15_dfe, m_90_10_15_psfe, m_90_10_15_gpfe)
etable(models_90_list, tex = TRUE, file = here("..", "tables", "models_90_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.9")
data_threshold_50 <- data_threshold_50 %>%
mutate(inter_always_treated = ifelse(treat_2010 == 1 & treat_2005 == 1, 1, 0),
inter_sometimes_treated = ifelse(treat_2010 == 1 | treat_2005 == 1, 1, 0))
m_05_10_15 <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005 , vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15)
m_05_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_dfe)
m_05_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_psfe)
m_05_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_gpfe)
models_05_10_15_list <- list(m_05_10_15, m_05_10_15_dfe, m_05_10_15_psfe, m_05_10_15_gpfe)
etable(models_05_10_15_list, tex = TRUE, file = here("..", "tables", "intermediate_05_10_15.tex"), placement = "htbp")
# TeX
models_05_10_15_list <- list(m_05_10_15, m_05_10_15_dfe, m_05_10_15_psfe, m_05_10_15_gpfe)
etable(models_05_10_15_list, tex = TRUE, file = here("..", "tables", "intermediate_05_10_15.tex"), placement = "htbp")
# Intermediate Always Treated
m_inter_always <- feols((sex_2015 == "F") ~ inter_always_treated, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always)
m_inter_always_dfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_dfe)
m_inter_always_psfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_psfe)
m_inter_always_gpfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_gpfe)
# TeX
m_inter_always_list <- list(m_inter_always, m_inter_always_dfe, m_inter_always_psfe, m_inter_always_gpfe)
etable(m_inter_always_list, tex = TRUE, file = here("..", "tables", "inter_always_list.tex"), placement = "htbp")
# Intermediate Sometimes Treated
m_inter_sometimes <- feols((sex_2015 == "F") ~ inter_sometimes_treated, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes) #similar coef as always treated!
m_inter_sometimes_dfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_dfe)
m_inter_sometimes_psfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_psfe)
m_inter_sometimes_gpfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_gpfe)
# TeX
m_inter_sometimes_list <- list(m_inter_sometimes, m_inter_sometimes_dfe, m_inter_sometimes_psfe, m_inter_sometimes_gpfe)
etable(m_inter_sometimes_list, tex = TRUE, file = here("..", "tables", "inter_sometimes_list.tex"), placement = "htbp")
m_inter_sometimes_gpfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_gpfe)
# TeX
m_inter_sometimes_list <- list(m_inter_sometimes, m_inter_sometimes_dfe, m_inter_sometimes_psfe, m_inter_sometimes_gpfe)
etable(m_inter_sometimes_list, tex = TRUE, file = here("..", "tables", "inter_sometimes_list.tex"), placement = "htbp")
etable(m_inter_sometimes_list, tex = TRUE, file = here("..", "tables", "inter_sometimes_treated.tex"), placement = "htbp")
etable(m_inter_always_list, tex = TRUE, file = here("..", "tables", "inter_always_treated.tex"), placement = "htbp")
library(estimatr)
contrast_matrix <- matrix(c(1, -1), nrow = 1)  # Example: Contrasting treat_2010 with treat_2005
# Fit a linear regression model
model <- lm((sex_2015 == "F") ~ treat_2005 + treat_2010, data = data_threshold_50)
treatment_effects <- contrast(contrast_matrix, coef(model))
coefficients <- coef(model)
inter_treat_effect <- contrast_matrix %*% coefficients
inter_treat_effect
coefficients
contrast_matrix <- make_contrasts(
treat_2010 = 1,
treat_2005 = -1
)
# Max Contrast Estimator
library(estimatr)
contrast_matrix <- make_contrasts(
treat_2010 = 1,
treat_2005 = -1
)
contrast_matrix <- matrix(c(1, -1), nrow = 1, byrow = TRUE)
max_con_estim <- lm_robust((sex_2015 == "F") ~ treat_2005 + treat_2010, data = data_threshold_50)
inter_treat_effect <- contrast(model, contrast_matrix)
contrast <- coefficients["treat_2005"] - coefficients["treat_2010"]
print(contrast)
diff_in_means_2005 <- lm_robust((sex_2015 == "F")  ~ treat_2005, data = data_threshold_50)
contrast_2005 <- make_contrast(diff_in_means_2005, "treat_2005")
# Max Contrast Estimator
fe_model <- feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)
# 1. Difference in Means for treat_2005
contrast_1 <- contrast(fe_model, list("treat_2005" = 1, "treat_2005" = 0))
# 1. Difference in Means for treat_2005
mean_treat_2005 <- mean(feols(sex_2015 ~ treat_2005 | gp_2015, data = data_threshold_50)$coefficients["treat_2005"])
# 1. Difference in Means for treat_2005
mean_treat_2005 <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2005"])
# 1. Difference in Means for treat_2005
mean_treat_2005 <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2005"])
mean_treat_2005
# 2. Difference in Means for treat_2010
mean_treat_2010 <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2010"])
# 3. Difference in Differences (DiD)
did_effect <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2005:treat_2010"])
# 4. Interaction Effect
interaction_effect <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2005:treat_2010"])
interaction_effect
# 3. Difference in Differences (DiD)
did_effect <- mean(feols((sex_2015 == "F") ~ treat_2005 + treat_2010 |  dist_name_2015 + samiti_name_2015 + gp_2015,  vcov = ~gp_2015, data = data_threshold_50)$coefficients["treat_2005:treat_2010"])
did_effect
mean_treat_2010
# 5. Main Effects of treat_2005 and treat_2010
contrast_5a <- contrast(fe_model, list("treat_2005" = 1))
contrast_5b <- contrast(fe_model, list("treat_2010" = 1))
mean_treat_2010
mean_treat_2005
fe_model
mean_treat_2005
mean_treat_2010
mean_treat_2005
# inefficient but does the job
raj_panch <- raj_panch %>%
mutate(
treat_2005 = ifelse(raj_panch$reservation_2005 %in% c("GEN W", "OBC W", "SC W", "ST W"), 1, 0),
treat_2010 = ifelse(raj_panch$reservation_2010 %in% c("GENW", "OBCW", "SCW", "STW"), 1, 0),
treat_2015 = ifelse(raj_panch$reservation_2015 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
treat_2020 = ifelse(raj_panch$reservation_2020 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
obc_2005 = ifelse(raj_panch$reservation_2005 %in% c("OBC W"), 1, 0),
obc_2010 = ifelse(raj_panch$reservation_2010 %in% c("OBCW"), 1, 0),
obc_2015 = ifelse(raj_panch$reservation_2015 %in% c("OBC (Woman)"), 1, 0),
obc_2020 = ifelse(raj_panch$reservation_2020 %in% c("OBC (Woman)"), 1, 0),
dalit_2005 = ifelse(raj_panch$reservation_2005 %in% c("SC W", "ST W"), 1, 0),
dalit_2010 = ifelse(raj_panch$reservation_2010 %in% c("SCW", "STW"), 1, 0),
dalit_2015 = ifelse(raj_panch$reservation_2015 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
dalit_2020 = ifelse(raj_panch$reservation_2020 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
always_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 3, 1, 0),
never_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 0, 1, 0),
sometimes_treated = ifelse(treat_2005 + treat_2010 + treat_2015 > 0, 1, 0),
treatment_intensity = treat_2005 + treat_2010 + treat_2015,
inter_always_treated = ifelse(treat_2010 == 1 & treat_2005 == 1, 1, 0),
inter_sometimes_treated = ifelse(treat_2010 == 1 | treat_2005 == 1, 1, 0)
)
library(readr)
library(dplyr)
library(xtable)
library(fuzzyjoin)
library(stringr)
library(here)
library(kableExtra)
library(fixest)
# Load data
data_dir <- here("..", "data/sarpanch_election_data")
sp_fin_file <- here(data_dir, "sp_2005_2010_2015_2020_fin.csv")
raj_panch <- readr::read_csv(sp_fin_file)
# inefficient but does the job
raj_panch <- raj_panch %>%
mutate(
treat_2005 = ifelse(raj_panch$reservation_2005 %in% c("GEN W", "OBC W", "SC W", "ST W"), 1, 0),
treat_2010 = ifelse(raj_panch$reservation_2010 %in% c("GENW", "OBCW", "SCW", "STW"), 1, 0),
treat_2015 = ifelse(raj_panch$reservation_2015 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
treat_2020 = ifelse(raj_panch$reservation_2020 %in% c("General (Woman)", "OBC (Woman)", "SC (Woman)", "ST (Woman)"), 1, 0),
obc_2005 = ifelse(raj_panch$reservation_2005 %in% c("OBC W"), 1, 0),
obc_2010 = ifelse(raj_panch$reservation_2010 %in% c("OBCW"), 1, 0),
obc_2015 = ifelse(raj_panch$reservation_2015 %in% c("OBC (Woman)"), 1, 0),
obc_2020 = ifelse(raj_panch$reservation_2020 %in% c("OBC (Woman)"), 1, 0),
dalit_2005 = ifelse(raj_panch$reservation_2005 %in% c("SC W", "ST W"), 1, 0),
dalit_2010 = ifelse(raj_panch$reservation_2010 %in% c("SCW", "STW"), 1, 0),
dalit_2015 = ifelse(raj_panch$reservation_2015 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
dalit_2020 = ifelse(raj_panch$reservation_2020 %in% c("SC (Woman)", "ST (Woman)"), 1, 0),
always_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 3, 1, 0),
never_treated = ifelse(treat_2005 + treat_2010 + treat_2015 == 0, 1, 0),
sometimes_treated = ifelse(treat_2005 + treat_2010 + treat_2015 > 0, 1, 0),
treatment_intensity = treat_2005 + treat_2010 + treat_2015,
inter_always_treated = ifelse(treat_2010 == 1 & treat_2005 == 1, 1, 0),
inter_sometimes_treated = ifelse(treat_2010 == 1 | treat_2005 == 1, 1, 0)
)
m_05_10 <- feols((sex_2010 =="F") ~ treat_2005, vcov = ~gp_2010, data = raj_panch)
summary(m_05_10)
m_05_10_dfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010, vcov = ~gp_2010,  data = raj_panch)
summary(m_05_10_dfe)
m_05_10_psfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010 + samiti_name_2010,vcov = ~gp_2010, data = raj_panch)
summary(m_05_10_psfe)
m_05_10_gpfe <- feols((sex_2010 =="F") ~ treat_2005 | dist_name_2010 + samiti_name_2010 + gp_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2010, data = raj_panch)
summary(m_05_10_gpfe)
# TeX
models_05_10_list <- list(m_05_10, m_05_10_dfe, m_05_10_psfe, m_05_10_gpfe)
etable(models_05_10_list, tex=T, file = here("..", "tables", "models_05_10.tex"))
extract_names_2015 <- raj_panch %>% select(name_2015)
library(stringr)
extract_names_2015 <- extract_names_2015 %>%
mutate(first_name = str_extract(name_2015, "\\w+")) %>%
mutate(first_name = ifelse(nchar(first_name) == 1, "", first_name))
extract_names_2015 <- extract_names_2015[,2, drop = FALSE]
extract_names_2015 <- extract_names_2015 <- extract_names_2015 %>%
mutate_all(tolower)
#naampy takes a vector of names, and doesn't handle blanks hence replace blanks with "asdfghjkl"
extract_names_2015 <- extract_names_2015 %>%
mutate(first_name = ifelse(first_name == "", "asdfghjkl", first_name))
dir <- here("..", "data/naampy_pred_names_2015")
pred_name_file <- here(dir, "pred_names_2015.csv")
pred_names <- read_csv(pred_name_file)
# to check if the lengths are the same
# length(pred_names$name) == length(extract_names_2015$first_name)
names(pred_names)
pred_names <-  pred_names %>%
rename(first_name_15 = name) %>%
rename(pred_gender_15 = pred_gender) %>%
rename(pred_prob_15 = pred_prob)
names(pred_names)
pred_names <- pred_names %>%
mutate(across(everything(), ~ ifelse(first_name_15 == "asdfghjkl",NA, .)))
naampy_merge_raj_panch <- cbind(raj_panch, pred_names)
# to check if cbind resulted in a proper match.
# extract first name from original data, ie., from how it was in raj_panch
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(first_name_15_og = str_extract(name_2015, "\\w+")) %>%
mutate(first_name_15_og = ifelse(nchar(first_name_15_og) == 1, "", first_name_15_og))
# check if first names in raj_panch  and naampy merge are the same
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(first_name_15_og = ifelse(first_name_15_og == "", NA, first_name_15_og))
naampy_merge_raj_panch$first_name_15_og <- tolower(naampy_merge_raj_panch$first_name_15_og)
print(identical(naampy_merge_raj_panch$first_name_15_og[2:length(naampy_merge_raj_panch$first_name_15_og)],
naampy_merge_raj_panch$first_name_15[2:length(naampy_merge_raj_panch$first_name_15)]))
unique(naampy_merge_raj_panch$pred_gender_15)
naampy_merge_raj_panch <- naampy_merge_raj_panch %>%
mutate(sex_2015 = ifelse(naampy_merge_raj_panch$pred_gender_15 == "female", "F",
ifelse(pred_gender_15 == "male", "M", "NA")))
summary(naampy_merge_raj_panch$pred_prob_15) # pred_prob \in [0.5006, 0.9998]
data_threshold_50 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.5006)
m_50_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15)
m_50_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_dfe)
m_50_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_psfe)
m_50_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_50)
summary(m_50_10_15_gpfe)
# TeX
models_50_list <- list(m_50_10_15, m_50_10_15_dfe, m_50_10_15_psfe, m_50_10_15_gpfe)
etable(models_50_list, tex = TRUE, file = here("..", "tables", "models_50_10_15.tex"),   placement = "htbp", title = "Results for Threshold 0.52")
data_threshold_60 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.6)
m_60_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15)
m_60_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_dfe)
m_60_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_psfe)
m_60_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_60)
summary(m_60_10_15_gpfe)
# TeX
models_60_list <- list(m_60_10_15, m_60_10_15_dfe, m_60_10_15_psfe, m_60_10_15_gpfe)
etable(models_60_list, tex = TRUE, file = here("..", "tables", "models_60_10_15.tex"),   placement = "htbp", title = "Results for Threshold 0.6")
data_threshold_70 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.7)
m_70_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15)
m_70_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_dfe)
m_70_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_psfe)
m_70_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_70)
summary(m_70_10_15_gpfe)
# TeX
models_70_list <- list(m_70_10_15, m_70_10_15_dfe, m_70_10_15_psfe, m_70_10_15_gpfe)
etable(models_70_list, tex = TRUE, file = here("..", "tables", "models_70_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.7")
# Naampy Pred_Prob > 0.8
data_threshold_80 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.8)
m_80_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15)
m_80_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_dfe)
m_80_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_psfe)
m_80_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_80)
summary(m_80_10_15_gpfe)
# TeX
models_80_list <- list(m_80_10_15, m_80_10_15_dfe, m_80_10_15_psfe, m_80_10_15_gpfe)
etable(models_80_list, tex = TRUE, file = here("..", "tables", "models_80_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.8")
# Naampy Pred_prob > 0.90
data_threshold_90 <- naampy_merge_raj_panch %>% filter(pred_prob_15 > 0.9)
m_90_10_15 <- feols((sex_2015 == "F") ~ treat_2010, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15)
m_90_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_dfe)
m_90_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_psfe)
m_90_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 | dist_name_2015 + samiti_name_2015 + gp_2015, ssc = ssc(fixef.K = "full"), vcov = ~gp_2015, data = data_threshold_90)
summary(m_90_10_15_gpfe) #weird. co-eff >1!
# TeX
models_90_list <- list(m_90_10_15, m_90_10_15_dfe, m_90_10_15_psfe, m_90_10_15_gpfe)
etable(models_90_list, tex = TRUE, file = here("..", "tables", "models_90_10_15.tex"), placement = "htbp", title = "Results for Threshold 0.9")
m_05_10_15 <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005 , vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15)
m_05_10_15_dfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_dfe)
m_05_10_15_psfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_psfe)
m_05_10_15_gpfe <- feols((sex_2015 == "F") ~ treat_2010 * treat_2005  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_05_10_15_gpfe)
# TeX
models_05_10_15_list <- list(m_05_10_15, m_05_10_15_dfe, m_05_10_15_psfe, m_05_10_15_gpfe)
etable(models_05_10_15_list, tex = TRUE, file = here("..", "tables", "intermediate_05_10_15.tex"), placement = "htbp")
# Intermediate Always Treated
m_inter_always <- feols((sex_2015 == "F") ~ inter_always_treated, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always)
m_inter_always_dfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_dfe)
m_inter_always_psfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_psfe)
m_inter_always_gpfe <- feols((sex_2015 == "F") ~ inter_always_treated  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_always_gpfe)
# TeX
m_inter_always_list <- list(m_inter_always, m_inter_always_dfe, m_inter_always_psfe, m_inter_always_gpfe)
etable(m_inter_always_list, tex = TRUE, file = here("..", "tables", "inter_always_treated.tex"), placement = "htbp")
# Intermediate Sometimes Treated
m_inter_sometimes <- feols((sex_2015 == "F") ~ inter_sometimes_treated, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes) #similar coef as always treated!
m_inter_sometimes_dfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_dfe)
m_inter_sometimes_psfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015 + samiti_name_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_psfe)
m_inter_sometimes_gpfe <- feols((sex_2015 == "F") ~ inter_sometimes_treated  | dist_name_2015 + samiti_name_2015 + gp_2015, vcov = ~gp_2015, data = data_threshold_50)
summary(m_inter_sometimes_gpfe)
# TeX
m_inter_sometimes_list <- list(m_inter_sometimes, m_inter_sometimes_dfe, m_inter_sometimes_psfe, m_inter_sometimes_gpfe)
etable(m_inter_sometimes_list, tex = TRUE, file = here("..", "tables", "inter_sometimes_treated.tex"), placement = "htbp")
